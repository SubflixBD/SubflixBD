<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Premium Black & White Shop</title>

    <!-- [ADVANCED PRO-SECURITY BLOCK START] -->
    <script>
        (function() {
            // ১. নির্দিষ্ট লিংক ও ডোমেইন সুরক্ষা (আপনার দেওয়া লিংক ছাড়া কাজ করবে না)
            const _targetHost = "subflixbd.github.io";
            const _targetPath = "/SubflixBD"; 
            const _safetyUrl = "https://www.google.com";

            function checkUrl() {
                const currentHost = window.location.hostname;
                const currentPath = window.location.pathname;

                // যদি ডোমেইন বা পাথ না মিলে, তবে গুগলে পাঠিয়ে দিবে
                if (currentHost !== _targetHost || !currentPath.includes(_targetPath)) {
                    // লোকাল পিসিতে টেস্ট করার জন্য এই লাইনটি কাজ করবে
                    if (currentHost !== "localhost" && currentHost !== "127.0.0.1") {
                        window.location.replace(_safetyUrl);
                    }
                }
            }
            checkUrl();

            // ২. মাউস ও কিবোর্ড পুরোপুরি অফ (Off)
            document.addEventListener('contextmenu', e => e.preventDefault()); // রাইট ক্লিক অফ
            
            document.onkeydown = function(e) {
                // F12, Ctrl+U, Ctrl+S, Ctrl+Shift+I, Ctrl+Shift+J, Ctrl+Shift+C, Ctrl+A সব ব্লক
                if (e.keyCode == 123 || 
                   (e.ctrlKey && (e.shiftKey && (e.keyCode == 73 || e.keyCode == 74 || e.keyCode == 67)) || 
                    e.keyCode == 85 || e.keyCode == 83 || e.keyCode == 80 || e.keyCode == 65)) {
                    window.location.replace(_safetyUrl);
                    return false;
                }
            };

            // ৩. প্রো-লেভেল দেব-টুলস প্রোটেকশন (Anti-Debugger)
            // কেউ জোর করে ইন্সপেক্ট খুলে কোড দেখার চেষ্টা করলে লুপে পড়ে যাবে
            setInterval(function() {
                (function() {
                    (function a() {
                        try {
                            (function b(i) {
                                if (('' + (i / i)).length !== 1 || i % 20 === 0) {
                                    (function() {}).constructor('debugger')();
                                } else {
                                    debugger;
                                }
                                b(++i);
                            })(0);
                        } catch (e) {
                            setTimeout(a, 5);
                        }
                    })();
                })();
                
                // কনসোল বা দেব-টুলস ওপেন হলেই গুগল রিডাইরেক্ট
                const devtools = /./;
                devtools.toString = function() {
                    window.location.replace(_safetyUrl);
                };
                console.log('%c', devtools);
            }, 1000);

            // ৪. টেক্সট কপি ও ড্র্যাগ পুরোপুরি ব্লক
            document.onselectstart = function() { return false; };
            document.ondragstart = function() { return false; };
        })();
    </script>
    <!-- [ADVANCED PRO-SECURITY BLOCK END] -->

    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Hind+Siliguri:wght@400;600;700&display=swap');
        body { font-family: 'Hind Siliguri', sans-serif; background-color: #ffffff; color: #000; -webkit-user-select: none; user-select: none; }
        
        .marquee-container { background: #ffffff; border-bottom: 1px solid #eeeeee; border-top: 1px solid #eeeeee; overflow: hidden; white-space: nowrap; padding: 10px 0; }
        .marquee-text { display: inline-block; animation: scroll 25s linear infinite; color: #000; font-weight: 600; font-size: 14px; }
        @keyframes scroll { 0% { transform: translateX(100%); } 100% { transform: translateX(-100%); } }

        .active-tab { color: #000; border-top: 3px solid #000; font-weight: 900; }
        .hidden { display: none; }
        .black-btn { background: #000; color: #fff; transition: 0.3s; border-radius: 12px;}
        .black-btn:active { transform: scale(0.95); opacity: 0.8; }
        .black-btn:disabled { background: #ccc; cursor: not-allowed; }

        .product-card { border: 1px solid #f3f4f6; border-radius: 16px; transition: 0.3s; background: #fff; }
        .product-card:hover { border-color: #000; box-shadow: 0 4px 12px rgba(0,0,0,0.05); }
        
        .variant-chip { padding: 4px 10px; border: 1px solid #eee; border-radius: 8px; font-size: 11px; font-weight: 600; cursor: pointer; transition: 0.2s; }
        .variant-chip.active { background: #000; color: #fff; border-color: #000; }

        .pay-method-icon { width: 50px; height: 50px; border-radius: 50%; object-fit: cover; cursor: pointer; transition: 0.3s; border: 2px solid #f3f4f6; }
        #bkash_img.selected { border-color: #e2136e; background: #fff1f6; transform: scale(1.1); box-shadow: 0 4px 10px rgba(226, 19, 110, 0.2); }
        #nagad_img.selected { border-color: #f47216; background: #fff5ed; transform: scale(1.1); box-shadow: 0 4px 10px rgba(244, 114, 22, 0.2); }

        .product-img { width: 75px; height: 75px; border-radius: 50%; object-fit: cover; background: #f9f9f9; border: 1px solid #f0f0f0; }

        .status-badge { font-size: 10px; font-weight: 800; text-transform: uppercase; padding: 4px 12px; border-radius: 9999px; letter-spacing: 0.5px; border: 1px solid transparent; }
        .status-pending { background: #fffbeb; color: #b45309; border-color: #fef3c7; }
        .status-success { background: #f0fdf4; color: #15803d; border-color: #dcfce7; }
        .status-cancelled { background: #fef2f2; color: #b91c1c; border-color: #fee2e2; }

        .qty-btn { width: 32px; height: 32px; border: 1px solid #000; display: flex; align-items: center; justify-content: center; font-weight: bold; cursor: pointer; border-radius: 8px; transition: 0.2s; }
        #headerProfileImg { width: 45px; height: 45px; border-radius: 50%; object-fit: cover; border: 2px solid #fff; box-shadow: 0 2px 5px rgba(255,255,255,0.2); }
        .modal-content-scroll { max-height: 80vh; overflow-y: auto; scrollbar-width: none; }

        .review-marquee-container { overflow: hidden; white-space: nowrap; padding: 15px 0; display: flex; }
        .review-marquee-inner { display: flex; animation: review-scroll 40s linear infinite; gap: 20px; }
        @keyframes review-scroll { 0% { transform: translateX(0); } 100% { transform: translateX(-50%); } }
        .review-card { min-width: 260px; background: #fff; border: 1px solid #f0f0f0; padding: 15px; border-radius: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.02); }
    </style>
</head>
<body class="pb-24">

    <!-- Header -->
    <header class="bg-black text-white p-4 sticky top-0 z-50 shadow-md flex justify-between items-center">
        <h1 id="shopName" class="text-xl font-black tracking-widest">লোড হচ্ছে...</h1>
        <div id="shopLogoContainer">
            <img id="headerProfileImg" src="https://via.placeholder.com/100" alt="Shop Profile">
        </div>
    </header>

    <!-- Notice -->
    <div class="marquee-container">
        <span id="adminNotice" class="marquee-text">আমাদের প্রিমিয়াম শপে আপনাকে স্বাগতম!</span>
    </div>

    <!-- MAIN SECTIONS -->
    <main id="main-content" class="p-4">
        <div id="home-sec">
            <h2 class="text-xl font-bold mb-5 border-l-4 border-black pl-3">প্যাকেজসমূহ</h2>
            <div id="productList" class="grid grid-cols-1 gap-4"></div>

            <!-- REVIEW SYSTEM -->
            <div class="mt-12 pt-8 border-t border-gray-100">
                <div class="flex items-center justify-between mb-4">
                    <h2 class="text-xl font-bold border-l-4 border-black pl-3">ইউজার রিভিউ</h2>
                </div>
                <div id="reviewSlider" class="review-marquee-container">
                    <div id="reviewList" class="review-marquee-inner"></div>
                </div>
                <div id="postReviewContainer" class="mt-8 bg-gray-50 rounded-3xl p-6 border border-gray-100">
                    <div id="reviewFormArea">
                        <h3 class="font-bold text-center mb-1">রিভিউ দিন</h3>
                        <p class="text-[11px] text-center text-gray-500 mb-4">আপনার অভিজ্ঞতা শেয়ার করুন</p>
                        <div class="flex justify-center gap-2 mb-4">
                            <i onclick="selectStar(1)" class="fas fa-star star-input" data-value="1"></i>
                            <i onclick="selectStar(2)" class="fas fa-star star-input" data-value="2"></i>
                            <i onclick="selectStar(3)" class="fas fa-star star-input" data-value="3"></i>
                            <i onclick="selectStar(4)" class="fas fa-star star-input" data-value="4"></i>
                            <i onclick="selectStar(5)" class="fas fa-star star-input active" data-value="5"></i>
                        </div>
                        <textarea id="userComment" placeholder="আপনার মন্তব্য লিখুন..." class="w-full bg-white border border-gray-200 rounded-2xl p-4 text-sm outline-none focus:border-black transition h-20 mb-3"></textarea>
                        <button id="submitReviewBtn" onclick="submitReview()" class="w-full black-btn py-3 font-bold text-sm">রিভিউ সাবমিট করুন</button>
                    </div>
                    <div id="alreadyReviewedMsg" class="hidden text-center py-4">
                        <p class="font-bold text-sm">রিভিউ সফলভাবে জমা হয়েছে!</p>
                    </div>
                </div>
            </div>
        </div>

        <div id="orders-sec" class="hidden">
            <h2 class="text-xl font-bold mb-5 border-l-4 border-black pl-3">আমার অর্ডার লিস্ট</h2>
            <div id="orderList" class="space-y-4"><p class="text-center text-gray-400 mt-10">লোড হচ্ছে...</p></div>
        </div>

        <div id="profile-sec" class="hidden">
            <div id="profileCard" class="bg-white rounded-2xl p-8 border border-gray-100 text-center">
                <div id="loggedOutView">
                    <h3 class="text-xl font-bold mb-4">লগইন প্রয়োজন</h3>
                    <button onclick="openAuthModal()" class="black-btn px-8 py-3 rounded-xl font-bold w-full">লগইন করুন</button>
                </div>
                <div id="loggedInView" class="hidden">
                    <h3 id="uName" class="text-2xl font-bold text-black"></h3>
                    <p id="uEmail" class="text-gray-500 mb-8"></p>
                    <button onclick="logout()" class="w-full py-4 border border-black rounded-xl font-bold">লগ আউট</button>
                </div>
            </div>
        </div>
    </main>

    <!-- Payment Modal -->
    <div id="payModal" class="fixed inset-0 bg-black/80 hidden flex items-center justify-center p-4 z-[100] backdrop-blur-sm">
        <div class="bg-white w-full max-w-md rounded-3xl overflow-hidden shadow-2xl flex flex-col">
            <div class="bg-black p-5 text-white text-center">
                <h3 id="pTitle" class="text-base font-bold truncate">পেমেন্ট ডিটেইলস</h3>
                <p id="pPriceDisplay" class="text-gray-400 text-xs mt-1"></p>
            </div>
            <div class="p-5 modal-content-scroll space-y-4">
                <div class="flex items-center justify-between bg-gray-50 p-3 rounded-xl">
                    <span class="font-bold text-sm">পরিমাণ (Qty)</span>
                    <div class="flex items-center gap-3">
                        <div onclick="updateQty(-1)" class="qty-btn">-</div>
                        <span id="qtyCount" class="text-base font-black">1</span>
                        <div onclick="updateQty(1)" class="qty-btn">+</div>
                    </div>
                </div>
                <div class="flex justify-center gap-6 py-2">
                    <img id="bkash_img" onclick="selectPayment('bkash')" src="https://itshm.smartitcare.com/storage/media/bkash.png" class="pay-method-icon" alt="Bkash">
                    <img id="nagad_img" onclick="selectPayment('nagad')" src="https://itshm.smartitcare.com/storage/media/nagad.png" class="pay-method-icon" alt="Nagad">
                </div>
                <div id="numberBox" class="hidden bg-black text-white p-3 rounded-xl text-center">
                    <p id="displayNo" class="text-lg font-black tracking-widest">017XXXXXXXX</p>
                    <button onclick="copyNumber()" class="bg-white/20 p-2 rounded-lg text-xs">কপি করুন</button>
                    <p id="copyMsg" class="text-[10px] text-green-400 opacity-0 transition">কপি হয়েছে!</p>
                </div>
                <input id="userWhatsApp" type="tel" placeholder="হোয়াটসঅ্যাপ নম্বর" class="w-full border p-3 rounded-xl outline-none">
                <input id="senderNo" type="tel" placeholder="পেমেন্টকৃত নম্বর" class="w-full border p-3 rounded-xl outline-none">
                <input id="trxId" type="text" placeholder="ট্রানজেকশন আইডি" class="w-full border p-3 rounded-xl outline-none">
                <button onclick="confirmOrder()" class="w-full black-btn py-4 rounded-xl font-bold">অর্ডার কনফার্ম - ৳ <span id="totalPay">0</span></button>
                <button onclick="closeModal('payModal')" class="w-full mt-3 text-gray-400 text-[10px] font-bold">ফিরে যান</button>
            </div>
        </div>
    </div>

    <!-- Navigation -->
    <nav class="fixed bottom-0 w-full bg-white border-t flex justify-around p-3 z-50">
        <button onclick="showSec('home')" id="btn-home" class="active-tab flex flex-col items-center">
            <i class="fas fa-house"></i><span class="text-[10px] mt-1">হোম</span>
        </button>
        <button onclick="showSec('orders')" id="btn-orders" class="text-gray-400 flex flex-col items-center">
            <i class="fas fa-shopping-bag"></i><span class="text-[10px] mt-1">অর্ডার</span>
        </button>
        <button onclick="showSec('profile')" id="btn-profile" class="text-gray-400 flex flex-col items-center">
            <i class="fas fa-user-circle"></i><span class="text-[10px] mt-1">প্রোফাইল</span>
        </button>
    </nav>

    <!-- Firebase SDKs & Script Logic (Keep existing logic) -->
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>

    <script>
        const _0xcf = {
            a: atob("QUl6YVN5Q1Q2YzNGemVIdzdxQS02LXFkYVlYNGljUlhlUmVRSFA4"), 
            b: atob("c3ViZmxpeGJkLTlkNzRiLmZpcmViYXNlYXBwLmNvbQ=="), 
            c: atob("c3ViZmxpeGJkLTlkNzRi"), 
            d: atob("c3ViZmxpeGJkLTlkNzRiLmZpcmViYXNlc3RvcmFnZS5hcHA="), 
            e: "404560801812", 
            f: "1:404560801812:web:dbac6ee6142cb31deab701" 
        };

        firebase.initializeApp({apiKey:_0xcf.a, authDomain:_0xcf.b, projectId:_0xcf.c, storageBucket:_0xcf.d, messagingSenderId:_0xcf.e, appId:_0xcf.f});
        const auth = firebase.auth();
        const db = firebase.firestore();

        let appSettings = {};
        let selectedMethod = null;
        let currentProduct = null;
        let quantity = 1;

        db.collection("settings").doc("app_info").onSnapshot(doc => {
            if(doc.exists) {
                appSettings = doc.data();
                document.getElementById('shopName').innerText = appSettings.shop_name || "Premium Shop";
                document.getElementById('adminNotice').innerText = appSettings.notice_text || "";
            }
        });

        function renderItem(p, id) {
            const list = document.getElementById('productList');
            list.innerHTML += `
                <div class="p-4 product-card flex justify-between items-center">
                    <div>
                        <h3 class="font-bold">${p.name}</h3>
                        <p class="font-black">৳ ${p.price}</p>
                    </div>
                    <button onclick="buyNow('${id}', '${p.name}', ${p.price})" class="black-btn px-6 py-2 text-xs">কিনুন</button>
                </div>`;
        }

        db.collection("products").onSnapshot(ss => {
            document.getElementById('productList').innerHTML = "";
            ss.forEach(doc => renderItem(doc.data(), doc.id));
        });

        function buyNow(id, name, price) {
            if(!auth.currentUser) return alert("লগইন করুন");
            currentProduct = { name, price };
            document.getElementById('pTitle').innerText = name;
            document.getElementById('totalPay').innerText = price;
            document.getElementById('payModal').classList.remove('hidden');
        }

        function selectPayment(method) {
            selectedMethod = method;
            document.getElementById('numberBox').classList.remove('hidden');
            document.getElementById('displayNo').innerText = appSettings[method + '_no'] || "01XXXXXXXXX";
        }

        function copyNumber() {
            navigator.clipboard.writeText(document.getElementById('displayNo').innerText);
            document.getElementById('copyMsg').classList.replace('opacity-0', 'opacity-100');
            setTimeout(() => document.getElementById('copyMsg').classList.replace('opacity-100', 'opacity-0'), 2000);
        }

        async function confirmOrder() {
            const wa = document.getElementById('userWhatsApp').value, sn = document.getElementById('senderNo').value, tx = document.getElementById('trxId').value;
            if(!wa || !selectedMethod || !sn || !tx) return alert("সব ঘর পূরণ করুন");
            await db.collection("orders").add({
                userEmail: auth.currentUser.email, product: currentProduct.name, totalPrice: currentProduct.price,
                method: selectedMethod, senderNo: sn, trxId: tx, status: "Pending", createdAt: firebase.firestore.FieldValue.serverTimestamp()
            });
            alert("অর্ডার সফল!"); location.reload();
        }

        function showSec(id) {
            document.querySelectorAll('main > div').forEach(d => d.classList.add('hidden'));
            document.getElementById(`${id}-sec`).classList.remove('hidden');
        }

        auth.onAuthStateChanged(user => {
            if(user) {
                document.getElementById('loggedOutView').classList.add('hidden');
                document.getElementById('loggedInView').classList.remove('hidden');
                document.getElementById('uEmail').innerText = user.email;
            }
        });

        function logout() { auth.signOut().then(() => location.reload()); }
        function closeModal(id) { document.getElementById(id).classList.add('hidden'); }
    </script>
</body>
</html>
